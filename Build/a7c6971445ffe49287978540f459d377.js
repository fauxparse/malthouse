!function(){String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},Number.prototype.pad=function(t){var e;for(null==t&&(t=2),e=this.toString();e.length<2;)e="0"+e;return e},Number.prototype.dollars=function(){var t;return t=this%100,t=0===t?"":10>t?".0"+t:"."+t,"$"+Math.floor(this/100)+t},Date.MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.prototype.db=function(){return""+this.getFullYear()+"-"+(this.getMonth()+1).pad()+"-"+this.getDate().pad()+" "+this.getHours().pad()+":"+this.getMinutes().pad()},Date.parseDB=function(t){var e,n;return"string"!=typeof t?t:(n=function(){var n,r,i,o;for(i=t.split(/[^\d]+/),o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(parseInt(e,10));return o}(),new Date(n[0],n[1]-1,n[2],n[3],n[4]))},Date.prototype.label=function(){return""+this.date()+", "+this.time()},Date.prototype.date=function(){return""+Date.DAYS[this.getDay()]+", "+this.getDate()+" "+Date.MONTHS[this.getMonth()]},Date.prototype.time=function(){return""+((this.getHours()-1)%12+1)+":"+this.getMinutes().pad()+(this.getHours()<12?"am":"pm")},"undefined"!=typeof Spine&&null!==Spine&&(Spine.Controller.prototype.after=function(t,e){return setTimeout(e,t)},Spine.Controller.prototype.immediately=function(t){return this.after(0,t)},Spine.Controller.prototype.every=function(t,e){return setInterval(e,t)})}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};window.Venue=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return r(n,e),n.configure("Venue","name","address","phone","geo","capacity"),n.prototype.capacity=function(t){return null!=t&&(this._capacity=parseInt(t,10)),this._capacity},n}(Spine.Model),window.Show=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return r(i,t),i.configure("Show","title","byline","dates","venue","price"),i.prototype.title=function(t){return null!=t&&(this._title=t),this._title},i.prototype.byline=function(t){return null!=t&&(this._byline=t),this._byline},i.prototype.dates=function(t){return null!=t&&(this._parsedDates=void 0,this._dates=$.extend({},t)),this._dates||{}},i.prototype.parsedDates=function(){var t,e,r;if(null==this._parsedDates){this._parsedDates=[],r=this.dates();for(t in r)n.call(r,t)&&(e=r[t],this._parsedDates.push(new Date(Date.parseDB(t))));this._parsedDates.sort(function(t,e){return t=t.getTime(),e=e.getTime(),e>t?-1:t>e?1:0})}return this._parsedDates},i.prototype.visible=function(){return Math.max.apply(Math,this.parsedDates())>+new Date},i.prototype.price=function(t){return null!=t&&(this._price=parseInt(t,10)),this._price},i.prototype.venue=function(t){return null!=t&&(this._venue_id=t.id||t),Venue.find(this._venue_id)},i.fetch=function(){return $.getJSON("/shows").done(function(t){return Venue.refresh(t.venues),i.refresh(t.shows)})},i}(Spine.Model)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};window.Booking=function(r){function i(){return t=i.__super__.constructor.apply(this,arguments)}return n(i,r),i.configure("Booking","show_id","date","tickets","name","email","phone","payment","paid","amount","comments"),i.extend(Spine.Model.Ajax),i.EMAIL=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,i.prototype.show_id=function(t){return null!=t&&(this._show_id=t),this._show_id},i.prototype.name=function(t){return null!=t&&(this._name=t),this._name},i.prototype.email=function(t){return null!=t&&(this._email=t),this._email},i.prototype.phone=function(t){return null!=t&&(this._phone=t),this._phone},i.prototype.payment=function(t){return null!=t&&(this._payment=t),this._payment},i.prototype.paid=function(t){return null!=t&&(this._paid=!!t),this._paid},i.prototype.date=function(t){return t&&(this._date=new Date(Date.parseDB(t))),this._date},i.prototype.tickets=function(t){return null!=t&&(this._tickets=parseInt(t,10)),this._tickets},i.prototype.amount=function(t){return null!=t&&(this._amount=parseInt(t,10)),this._amount},i.prototype.show=function(){return Show.find(this.show_id())},i.prototype.validate=function(){var t,n;t={},this.show_id()||(t.show_id="Please select a show"),this.date()&&this._date.getTime&&!isNaN(this._date.getTime())||(t.date="Please select a performance"),this.name()||(t.name="Please fill in your name"),this.email()||this.phone()||(t.email="Please fill in your email address or phone number"),this.email()&&!this.email().match(this.constructor.EMAIL)&&(t.email="Please check your email address"),(isNaN(this.tickets())||this.tickets()<1)&&(t.tickets="Please select a number of tickets");for(n in t)if(e.call(t,n))return t},i.prototype.total=function(t){var e;return null!=t&&(this._total=t),null!=(e=this._total)?e:this.show().price()*this.tickets()},i.prototype.toJSON=function(){var t,e;return t=i.__super__.toJSON.apply(this,arguments),$.extend({},t,{date:null!=(e=this.date())?e.db():void 0})},i.fetchSummary=function(){var t;return t=$.Deferred(),$.getJSON("/bookings").done(function(e){return Show.refresh(e.shows),t.resolve()}),t},i.partition=function(){return this.all().reduce(function(t,e){var n;return(null!=t[n=e.date().db()]?t[n=e.date().db()]:t[n]=[]).push(e)&&t},{})},i}(Spine.Model)}.call(this),function(){$(function(){return Booking.fetchSummary().done(function(){return Show.each(function(t){return $("<a>",{href:"/bookings/"+t.id}).html(t.title()).appendTo("ul").wrap("<li>")})})})}.call(this);
;