!function(){String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},Number.prototype.pad=function(t){var e;for(null==t&&(t=2),e=this.toString();e.length<2;)e="0"+e;return e},Number.prototype.dollars=function(){var t;return t=this%100,t=0===t?"":10>t?".0"+t:"."+t,"$"+Math.floor(this/100)+t},Date.MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.prototype.db=function(){return""+this.getFullYear()+"-"+(this.getMonth()+1).pad()+"-"+this.getDate().pad()+" "+this.getHours().pad()+":"+this.getMinutes().pad()},Date.parseDB=function(t){var e,n;return"string"!=typeof t?t:(n=function(){var n,r,o,i;for(o=t.split(/[^\d]+/),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(parseInt(e,10));return i}(),new Date(n[0],n[1]-1,n[2],n[3],n[4]))},Date.prototype.label=function(){return""+this.date()+", "+this.time()},Date.prototype.date=function(){return""+Date.DAYS[this.getDay()]+", "+this.getDate()+" "+Date.MONTHS[this.getMonth()]},Date.prototype.time=function(){return""+((this.getHours()-1)%12+1)+":"+this.getMinutes().pad()+(this.getHours()<12?"am":"pm")},"undefined"!=typeof Spine&&null!==Spine&&(Spine.Controller.prototype.after=function(t,e){return setTimeout(e,t)},Spine.Controller.prototype.immediately=function(t){return this.after(0,t)},Spine.Controller.prototype.every=function(t,e){return setInterval(e,t)})}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};window.Venue=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return r(n,e),n.configure("Venue","name","address","phone","geo","capacity"),n.prototype.capacity=function(t){return null!=t&&(this._capacity=parseInt(t,10)),this._capacity},n}(Spine.Model),window.Show=function(t){function n(){return e=n.__super__.constructor.apply(this,arguments)}return r(n,t),n.configure("Show","title","byline","dates","venue","price"),n.prototype.title=function(t){return null!=t&&(this._title=t),this._title},n.prototype.byline=function(t){return null!=t&&(this._byline=t),this._byline},n.prototype.dates=function(t){var e;return null!=t&&(this._dates=function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(new Date(Date.parseDB(e)));return o}()),(this._dates||[]).slice(0)},n.prototype.price=function(t){return null!=t&&(this._price=parseInt(t,10)),this._price},n.prototype.venue=function(t){return null!=t&&(this._venue_id=t.id||t),Venue.find(this._venue_id)},n.fetch=function(){return $.getJSON("/shows").done(function(t){return Venue.refresh(t.venues),n.refresh(t.shows)})},n}(Spine.Model)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};window.Booking=function(r){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,r),o.configure("Booking","show_id","date","tickets","name","email","phone","payment","paid","amount"),o.extend(Spine.Model.Ajax),o.EMAIL=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o.prototype.show_id=function(t){return null!=t&&(this._show_id=t),this._show_id},o.prototype.name=function(t){return null!=t&&(this._name=t),this._name},o.prototype.email=function(t){return null!=t&&(this._email=t),this._email},o.prototype.phone=function(t){return null!=t&&(this._phone=t),this._phone},o.prototype.payment=function(t){return null!=t&&(this._payment=t),this._payment},o.prototype.paid=function(t){return null!=t&&(this._paid=!!t),this._paid},o.prototype.date=function(t){return null!=t&&(this._date=new Date(Date.parseDB(t))),this._date},o.prototype.tickets=function(t){return null!=t&&(this._tickets=parseInt(t,10)),this._tickets},o.prototype.amount=function(t){return null!=t&&(this._amount=parseInt(t,10)),this._amount},o.prototype.show=function(){return Show.find(this.show_id())},o.prototype.validate=function(){var t,n;t={},this.show_id()||(t.show_id="Please select a show"),this.date()||(t.date="Please select a performance"),this.name()||(t.name="Please fill in your name"),this.email()||this.phone()||(t.email="Please fill in your email address or phone number"),this.email()&&!this.email().match(this.constructor.EMAIL)&&(t.email="Please check your email address"),(isNaN(this.tickets())||this.tickets()<1)&&(t.tickets="Please select a number of tickets");for(n in t)if(e.call(t,n))return t},o.prototype.total=function(t){var e;return null!=t&&(this._total=t),null!=(e=this._total)?e:this.show().price()*this.tickets()},o.prototype.toJSON=function(){var t,e;return t=o.__super__.toJSON.apply(this,arguments),$.extend({},t,{date:null!=(e=this.date())?e.db():void 0})},o.fetchSummary=function(){var t;return t=$.Deferred(),$.getJSON("/bookings").done(function(e){return Show.refresh(e.shows),t.resolve()}),t},o.partition=function(){return this.all().reduce(function(t,e){var n;return(null!=t[n=e.date().db()]?t[n=e.date().db()]:t[n]=[]).push(e)&&t},{})},o}(Spine.Model)}.call(this),function(){$(function(){return Booking.fetchSummary().done(function(){return Show.each(function(t){return $("<a>",{href:"/bookings/"+t.id}).html(t.title()).appendTo("ul").wrap("<li>")})})})}.call(this);
;